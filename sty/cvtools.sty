%==============================================================================%
% cvtools.sty
%------------------------------------------------------------------------------%
%
%==============================================================================%

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{cvtools}

\RequirePackage{commalist}
\RequirePackage{etoolbox} 			% for \ifstrempty, \ifdef
\RequirePackage{ifthen}				% for \ifthenelse
\RequirePackage{longtable} 			% for tables that span more than one page
\RequirePackage{tabularx} 			% for simple column stretching
\RequirePackage{xcolor} 			% for colours

%==============================================================================%
% For table styling
%==============================================================================%
\definecolor{lightgray}{gray}{0.8}
\newcolumntype{L}[1]{>{\raggedleft}p{#1}}
\newcolumntype{R}[1]{p{#1}}
\newcommand\VRule{\color{lightgray}\vrule width 0.5pt}

% http://tex.stackexchange.com/a/63756/13522
\newcommand\multirow[1]{\smash{\parbox[t]{\lwidth}{\raggedright #1}}}


%==============================================================================%
% Custom formatting
%==============================================================================%
\newcommand\jobTitle[1]{\emph{#1}}
\newcommand\company[1]{``#1''}
\newcommand\qualificationName[1]{\emph{#1}}
\newcommand\educationInstitute[1]{``#1''}
\newcommand\educationalInstitution[1]{``#1''}


\newenvironment{@longtable}{%
    \begin{longtable}{>{\bfseries}L{\lwidth}!{\VRule}R{\rwidth}}%
}{%
    \end{longtable}%
}

%==============================================================================%
% \begin{personalDetails}
% \personalDetailsItem{itemName}{itemValue}
% \personalDetailsItemWithSpace{itemName}{itemValue}
% \end{personalDetails}
%==============================================================================%
\newenvironment{personalDetails}{%
    \def\lwidth{0.16\textwidth}%
    \def\rwidth{0.78\textwidth}%
    %
    \newcommand\personalDetailsItem[2]{##1 & ##2 \\}%
    \newcommand\personalDetailsItemWithSpace[2]{##1 & ##2 \\[1em]}%
    %
    \begin{@longtable}%
}{%
    \end{@longtable}%
}

%==============================================================================%
% \begin{technicalSkills}
% \technicalSkillsItem}{itemName}{itemValues}
% \end{technicalSkills}
%==============================================================================%
\newenvironment{technicalSkills}{%
    \def\lwidth{0.3\textwidth}%
    \def\rwidth{0.64\textwidth}%
    %
    \newcommand\technicalSkillsItem[2]{%
        ##1 &%
        \begin{commalist}
            ##2%
        \end{commalist}.%
        % Phantom prevents the comma list from expanding to the whole row width.
        \hfill \null \\[0.5em]%
    }%
    %
    \begin{@longtable}%
}{%
    \end{@longtable}%
}

%==============================================================================%
% \begin{professionalExperience}
% \professionalExperienceItem{startEmploymentPeriod}{endEmploymentPeriod}{position}{company}{jobDescription}
% \end{professionalExperience}
%==============================================================================%
\newenvironment{professionalExperience}{%
    \def\lwidth{0.16\textwidth}%
    \def\rwidth{0.78\textwidth}%
    %
    \newcommand\professionalExperienceItem[6]{%
        % Employment period
        \smash{\parbox[t]{\lwidth}{\raggedright ##1 -- ##2}}%
        %
        % Position and company
        & \textbf{##3 (##4)}\\*%
        %
        % Job description
        & ##5%
        %
        \\[1em]%
    }%
    %
    \begin{@longtable}%
}{%
    \end{@longtable}%
}

%==============================================================================%
% \begin{education}
% \educationItem{beginYear}{endYear}{name}{institution}{\educationGrade{code}{subject}{grade} ...}
% \end{education}
%==============================================================================%
\newenvironment{education}{%
    \def\lwidth{0.16\textwidth}%
    \def\rwidth{0.78\textwidth}%
    %
    \newcommand\educationGrade[3]{%
        \ifstrempty{##1}{}{\emph{##1:}} ##2 & ##3 \\%
    }%
    %
    \newcommand\educationItem[5]{%
        % Education period
        \smash{\parbox[t]{\lwidth}{\raggedright ##1 -- ##2}}%
        %
        % Name and institution
        & \textbf{##3 (##4)}%
        %
        % Grades
        \ifstrempty{##5}{}{%
            \\*%
            & \begin{tabularx}{\rwidth}{Xr}%
                ##5%
            \end{tabularx}%
        }%
        \\[0.5em]%
    }%
    %
    \begin{@longtable}%
}{%
    \end{@longtable}%
}

%==============================================================================%
% \begin{licenses}
% \licenseItem{name}{provider}{description}
% \end{licenses}
%==============================================================================%
\newenvironment{licenses}{%
    \def\lwidth{0.25\textwidth}%
    \def\rwidth{0.69\textwidth}%
    %
    \newcommand\licenseItem[3]{##1 & ##3 \\}%
    %
    \begin{@longtable}%
}{%
    \end{@longtable}%
}

%==============================================================================%
% \begin{qualifications}
% \qualificationItem{date}{name}{description}
% \end{qualifications}
%==============================================================================%
\newenvironment{qualifications}{%
    \def\lwidth{0.20\textwidth}%
    \def\rwidth{0.74\textwidth}%
    %
    \newcommand\qualificationItem[3]{%
        \smash{\parbox[t]{\lwidth}{\raggedright ##1}}%
        & \textbf{##2} \\*%
        & ##3 \\[0.5em]%
    }%
    %
    \begin{@longtable}%
}{%
    \end{@longtable}%
}

%==============================================================================%
% \begin{achievements}
% \achievement{date}{name}{description}
% \end{achievements}
%==============================================================================%
\newenvironment{achievements}{%
    \def\lwidth{0.16\textwidth}%
    \def\rwidth{0.78\textwidth}%
    %
    \newcommand\achievement[3]{%
        \multirow{##1} & \textbf{##2} \\* & ##3 \\[0.5em]%
    }%
    %
    \begin{@longtable}%
}{%
    \end{@longtable}%
}
